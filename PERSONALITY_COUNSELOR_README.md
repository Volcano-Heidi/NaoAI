# NAO 心理咨询师系统 - 性格选择版

## 概述

这是一个支持三种性格的 NAO 机器人心理咨询师系统：
- **幽默**：幽默风趣，用轻松的方式缓解来访者的压力
- **温柔**：温柔体贴，用温暖的话语给予来访者支持和安慰
- **专业**：专业严谨，用科学的方法和专业的视角提供咨询

## 功能特点

1. **性格选择**：用户可以选择三种不同的性格
2. **LLM 集成**：使用 SoulChat2.0 模型生成个性化回复
3. **NAO 动作**：根据性格和对话内容执行相应的肢体动作
4. **语音交互**：支持 NAO 机器人语音回复
5. **会话管理**：自动保存对话历史和咨询进度

## 快速开始

### 1. 启动 SoulChat2.0 服务

确保 SoulChat2.0 服务正在运行：

```bash
# 检查服务
curl http://localhost:8001/v1/models

# 如果未运行，启动服务（参考 SOULCHAT_SETUP.md）
export MODEL_NAME_OR_PATH=/path/to/SoulChat2.0-Llama-3.1-8B
# 运行 vLLM 服务...
```

### 2. 设置 NAO 机器人（可选）

如果使用 NAO 机器人：

```bash
export NAO_IP=192.168.10.3  # 替换为您的 NAO IP
export NAO_PORT=9559
```

### 3. 启动系统

```bash
./start_personality_counselor.sh
```

或直接运行：

```bash
python2 personality_counselor.py
```

## 使用流程

1. **选择性格**：首次运行时会提示选择性格
   - 1. 幽默
   - 2. 温柔
   - 3. 专业

2. **开始对话**：系统会使用所选性格的开场白开始

3. **进行咨询**：输入您的问题或想法，NAO 会根据性格特点回复

4. **结束对话**：输入 `quit`、`exit` 或 `退出` 结束对话

## 性格特点

### 幽默性格
- **语言风格**：轻松幽默，适当使用幽默缓解紧张
- **动作风格**：活泼、动作幅度较大
- **适用场景**：适合需要轻松氛围的来访者

### 温柔性格
- **语言风格**：温柔体贴，用温暖的话语给予支持
- **动作风格**：温和、动作幅度较小
- **适用场景**：适合需要情感支持的来访者

### 专业性格
- **语言风格**：专业严谨，基于心理学理论提供建议
- **动作风格**：正式、动作较为克制
- **适用场景**：适合需要专业分析的来访者

## NAO 动作系统

系统会根据以下因素自动选择动作：

1. **性格类型**：不同性格有不同的动作风格
2. **对话内容**：根据关键词选择相应动作
   - 开场：挥手问候
   - 提问：头部倾斜
   - 鼓励：点头和张开手臂
   - 共情：双手放在胸前
   - 思考：头部倾斜和手部动作
   - 结束：挥手告别

3. **说话期间**：定期执行倾听动作（点头）

## 文件说明

- `personality_config.py` - 性格配置和提示词模板
- `personality_counselor.py` - 主程序
- `nao_motions.py` - NAO 动作库（已更新支持性格）
- `start_personality_counselor.sh` - 启动脚本

## 自定义性格提示词

您可以在 `personality_config.py` 中修改各性格的提示词：

```python
PERSONALITY_CONFIGS = {
    'humorous': {
        'system_prompt_template': u"""您的提示词...""",
        'greeting': u"开场白...",
        'closing': u"结束语...",
    },
    # ...
}
```

## 会话管理

对话历史保存在 `counseling_session.json` 文件中，包括：
- 选择的性格
- 咨询阶段
- 对话历史
- 用户信息

如需重新选择性格，删除此文件即可。

## 故障排除

### 问题：无法连接到 SoulChat2.0

**解决方案**：
1. 检查服务是否运行：`curl http://localhost:8001/v1/models`
2. 检查端口是否正确（默认 8001）
3. 查看 SOULCHAT_SETUP.md 文档

### 问题：NAO 机器人无动作

**解决方案**：
1. 检查 NAO_IP 是否正确设置
2. 检查 NAO 机器人是否已开机
3. 运行 `python2 check_nao_sdk.py` 检查 SDK 配置

### 问题：无法识别性格

**解决方案**：
1. 确保 `personality_config.py` 文件存在
2. 检查 Python 版本（需要 Python 2.7）

## 下一步改进

1. **添加更多性格**：可以扩展更多性格类型
2. **优化动作**：根据对话内容更精确地选择动作
3. **语音输入**：集成语音识别功能
4. **情感分析**：根据用户情感调整回复和动作

## 参考文档

- `SOULCHAT_SETUP.md` - SoulChat2.0 设置指南
- `NAO_SDK_SETUP.md` - NAO SDK 设置指南
- `NAO_MOTIONS_README.md` - NAO 动作系统说明

